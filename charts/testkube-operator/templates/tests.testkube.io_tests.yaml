{{ if .Values.installCRD }}
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.8.0
  name: tests.tests.testkube.io
spec:
  conversion:
    strategy: Webhook
    webhook:
      clientConfig:
        service:
          name: {{ include "testkube-operator.webhookServiceName" . }}
          namespace: {{ include "testkube-operator.namespace" . }}
          path: /convert
      conversionReviewVersions:
        - v1
        - v1beta1
  group: tests.testkube.io
  names:
    kind: Test
    listKind: TestList
    plural: tests
    singular: test
  scope: Namespaced
  versions:
    - name: v1
      schema:
        openAPIV3Schema:
          description: Test is the Schema for the tests API
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            spec:
              description: TestSpec defines the desired state of Test
              properties:
                after:
                  description: After steps is list of scripts which will be sequentially
                    orchestrated
                  items:
                    description: TestStepSpec will of particular type will have config
                      for possible step types
                    properties:
                      delay:
                        properties:
                          duration:
                            description: Duration in ms
                            format: int32
                            type: integer
                        type: object
                      execute:
                        properties:
                          name:
                            type: string
                          namespace:
                            type: string
                          stopOnFailure:
                            type: boolean
                        type: object
                      type:
                        type: string
                    type: object
                  type: array
                before:
                  description: Before steps is list of scripts which will be sequentially
                    orchestrated
                  items:
                    description: TestStepSpec will of particular type will have config
                      for possible step types
                    properties:
                      delay:
                        properties:
                          duration:
                            description: Duration in ms
                            format: int32
                            type: integer
                        type: object
                      execute:
                        properties:
                          name:
                            type: string
                          namespace:
                            type: string
                          stopOnFailure:
                            type: boolean
                        type: object
                      type:
                        type: string
                    type: object
                  type: array
                description:
                  type: string
                repeats:
                  type: integer
                steps:
                  description: Steps is list of scripts which will be sequentially orchestrated
                  items:
                    description: TestStepSpec will of particular type will have config
                      for possible step types
                    properties:
                      delay:
                        properties:
                          duration:
                            description: Duration in ms
                            format: int32
                            type: integer
                        type: object
                      execute:
                        properties:
                          name:
                            type: string
                          namespace:
                            type: string
                          stopOnFailure:
                            type: boolean
                        type: object
                      type:
                        type: string
                    type: object
                  type: array
                tags:
                  items:
                    type: string
                  type: array
              type: object
            status:
              description: TestStatus defines the observed state of Test
              type: object
          type: object
      served: true
      storage: false
      subresources:
        status: {}
    - name: v2
      schema:
        openAPIV3Schema:
          description: Test is the Schema for the tests API
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            spec:
              description: TestSpec defines the desired state of Test
              properties:
                content:
                  description: test content object
                  properties:
                    data:
                      description: test content body
                      type: string
                    repository:
                      description: repository of test content
                      properties:
                        branch:
                          description: branch/tag name for checkout
                          type: string
                        commit:
                          description: commit id (sha) for checkout
                          type: string
                        path:
                          description: if needed we can checkout particular path (dir
                            or file) in case of BIG/mono repositories
                          type: string
                        token:
                          description: git auth token for private repositories
                          type: string
                        type:
                          description: VCS repository type
                          type: string
                        uri:
                          description: uri of content file or git directory
                          type: string
                        username:
                          description: git auth username for private repositories
                          type: string
                      required:
                        - type
                        - uri
                      type: object
                    type:
                      description: test type
                      type: string
                    uri:
                      description: uri of test content
                      type: string
                  type: object
                executorArgs:
                  description: additional executor binary arguments
                  items:
                    type: string
                  type: array
                name:
                  description: test execution custom name
                  type: string
                params:
                  additionalProperties:
                    type: string
                  description: DEPRECATED execution params passed to executor
                  type: object
                schedule:
                  description: schedule in cron job format for scheduled test execution
                  type: string
                type:
                  description: test type
                  type: string
                variables:
                  additionalProperties:
                    properties:
                      name:
                        description: variable name
                        type: string
                      type:
                        description: variable type
                        type: string
                      value:
                        description: variable string value
                        type: string
                      valueFrom:
                        description: or load it from var source
                        properties:
                          configMapKeyRef:
                            description: Selects a key of a ConfigMap.
                            properties:
                              key:
                                description: The key to select.
                                type: string
                              name:
                                description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                                TODO: Add other useful fields. apiVersion, kind, uid?'
                                type: string
                              optional:
                                description: Specify whether the ConfigMap or its key
                                  must be defined
                                type: boolean
                            required:
                              - key
                            type: object
                          fieldRef:
                            description: 'Selects a field of the pod: supports metadata.name,
                            metadata.namespace, `metadata.labels[''<KEY>'']`, `metadata.annotations[''<KEY>'']`,
                            spec.nodeName, spec.serviceAccountName, status.hostIP,
                            status.podIP, status.podIPs.'
                            properties:
                              apiVersion:
                                description: Version of the schema the FieldPath is
                                  written in terms of, defaults to "v1".
                                type: string
                              fieldPath:
                                description: Path of the field to select in the specified
                                  API version.
                                type: string
                            required:
                              - fieldPath
                            type: object
                          resourceFieldRef:
                            description: 'Selects a resource of the container: only
                            resources limits and requests (limits.cpu, limits.memory,
                            limits.ephemeral-storage, requests.cpu, requests.memory
                            and requests.ephemeral-storage) are currently supported.'
                            properties:
                              containerName:
                                description: 'Container name: required for volumes,
                                optional for env vars'
                                type: string
                              divisor:
                                anyOf:
                                  - type: integer
                                  - type: string
                                description: Specifies the output format of the exposed
                                  resources, defaults to "1"
                                pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                x-kubernetes-int-or-string: true
                              resource:
                                description: 'Required: resource to select'
                                type: string
                            required:
                              - resource
                            type: object
                          secretKeyRef:
                            description: Selects a key of a secret in the pod's namespace
                            properties:
                              key:
                                description: The key of the secret to select from.  Must
                                  be a valid secret key.
                                type: string
                              name:
                                description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                                TODO: Add other useful fields. apiVersion, kind, uid?'
                                type: string
                              optional:
                                description: Specify whether the Secret or its key must
                                  be defined
                                type: boolean
                            required:
                              - key
                            type: object
                        type: object
                    type: object
                  description: Variables are new params with secrets attached
                  type: object
              type: object
            status:
              description: TestStatus defines the observed state of Test
              properties:
                executions_count:
                  type: integer
                last_execution:
                  format: date-time
                  type: string
              type: object
          type: object
      served: true
      storage: false
      subresources:
        status: {}
    - name: v3
      schema:
        openAPIV3Schema:
          description: Test is the Schema for the tests API
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            spec:
              description: TestSpec defines the desired state of Test
              properties:
                content:
                  description: test content object
                  properties:
                    data:
                      description: test content body
                      type: string
                    repository:
                      description: repository of test content
                      properties:
                        authType:
                          description: auth type for git requests
                          enum:
                          - basic
                          - header
                          type: string
                        branch:
                          description: branch/tag name for checkout
                          type: string
                        commit:
                          description: commit id (sha) for checkout
                          type: string
                        path:
                          description: if needed we can checkout particular path (dir
                            or file) in case of BIG/mono repositories
                          type: string
                        tokenSecret:
                          description: Testkube internal reference for secret storage
                            in Kubernetes secrets
                          properties:
                            key:
                              description: object key
                              type: string
                            name:
                              description: object name
                              type: string
                            namespace:
                              description: object kubernetes namespace
                              type: string
                          required:
                            - key
                            - name
                          type: object
                        certificateSecret:
                          description: certificateSecret is a reference to a secret
                            containing a certificate to use for git authentication
                          type: string
                        type:
                          description: VCS repository type
                          type: string
                        uri:
                          description: uri of content file or git directory
                          type: string
                        usernameSecret:
                          description: Testkube internal reference for secret storage
                            in Kubernetes secrets
                          properties:
                            key:
                              description: object key
                              type: string
                            name:
                              description: object name
                              type: string
                            namespace:
                              description: object kubernetes namespace
                              type: string
                          required:
                            - key
                            - name
                          type: object
                        workingDir:
                          description: if provided we checkout the whole repository
                            and run test from this directory
                          type: string
                      type: object
                    type:
                      description: test type
                      enum:
                      - string
                      - file-uri
                      - git-file
                      - git-dir
                      - git
                      type: string
                    uri:
                      description: uri of test content
                      type: string
                  type: object
                executionRequest:
                  description: test execution request body
                  properties:
                    negativeTest:
                      description: negative test will fail if it is a success and it will succeed
                        if it is a failure
                      type: boolean
                    activeDeadlineSeconds:
                      description: Optional duration in seconds the pod may be active
                        on the node relative to StartTime before the system will actively
                        try to mark it failed and kill associated containers. Value
                        must be a positive integer.
                      format: int64
                      type: integer
                    args:
                      description: additional executor binary arguments
                      items:
                        type: string
                      type: array
                    argsMode:
                      description: usage mode for arguments
                      enum:
                      - append
                      - override
                      type: string
                    artifactRequest:
                      description: artifact request body with test artifacts
                      properties:
                        dirs:
                          description: artifact directories for scraping
                          items:
                            type: string
                          type: array
                        storageClassName:
                          description: artifact storage class name for container executor
                          type: string
                        volumeMountPath:
                          description: artifact volume mount path for container executor
                          type: string
                      type: object
                    command:
                      description: executor binary command
                      items:
                        type: string
                      type: array
                    cronJobTemplate:
                      description: cron job template extensions
                      type: string
                    envConfigMaps:
                      description: config map references
                      items:
                        description: Reference to env resource
                        properties:
                          mapToVariables:
                            description: whether we shoud map to variables from resource
                            type: boolean
                          mount:
                            description: whether we shoud mount resource
                            type: boolean
                          mountPath:
                            description: where we shoud mount resource
                            type: string
                          reference:
                            description: LocalObjectReference contains enough information
                              to let you locate the referenced object inside the same
                              namespace.
                            properties:
                              name:
                                description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                                  TODO: Add other useful fields. apiVersion, kind, uid?'
                                type: string
                            type: object
                        required:
                        - reference
                        type: object
                      type: array
                    envSecrets:
                      description: secret references
                      items:
                        description: Reference to env resource
                        properties:
                          mapToVariables:
                            description: whether we shoud map to variables from resource
                            type: boolean
                          mount:
                            description: whether we shoud mount resource
                            type: boolean
                          mountPath:
                            description: where we shoud mount resource
                            type: string
                          reference:
                            description: LocalObjectReference contains enough information
                              to let you locate the referenced object inside the same
                              namespace.
                            properties:
                              name:
                                description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                                  TODO: Add other useful fields. apiVersion, kind, uid?'
                                type: string
                            type: object
                        required:
                        - reference
                        type: object
                      type: array
                    envs:
                      additionalProperties:
                        type: string
                      description: 'Environment variables passed to executor. Deprecated:
                        use Basic Variables instead'
                      type: object
                    executionLabels:
                      additionalProperties:
                        type: string
                      description: test execution labels
                      type: object
                    httpProxy:
                      description: http proxy for executor containers
                      type: string
                    httpsProxy:
                      description: https proxy for executor containers
                      type: string
                    image:
                      description: container executor image
                      type: string
                    imagePullSecrets:
                      description: container executor image pull secrets
                      items:
                        description: LocalObjectReference contains enough information
                          to let you locate the referenced object inside the same namespace.
                        properties:
                          name:
                            description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                            TODO: Add other useful fields. apiVersion, kind, uid?'
                            type: string
                        type: object
                      type: array
                    jobTemplate:
                      description: job template extensions
                      type: string
                    name:
                      description: test execution custom name
                      type: string
                    namespace:
                      description: test kubernetes namespace (\"testkube\" when not
                        set)
                      type: string
                    number:
                      description: test execution number
                      format: int32
                      type: integer
                    preRunScript:
                      description: script to run before test execution
                      type: string 
                    scraperTemplate:
                      description: scraper template extensions
                      type: string
                    secretEnvs:
                      additionalProperties:
                        type: string
                      description: 'Execution variables passed to executor from secrets.
                        Deprecated: use Secret Variables instead'
                      type: object
                    sync:
                      description: whether to start execution sync or async
                      type: boolean
                    testSecretUUID:
                      description: test secret uuid
                      type: string
                    testSuiteName:
                      description: unique test suite name (CRD Test suite name), if
                        it's run as a part of test suite
                      type: string
                    testSuiteSecretUUID:
                      description: test suite secret uuid, if it's run as a part of
                        test suite
                      type: string
                    variables:
                      additionalProperties:
                        properties:
                          name:
                            description: variable name
                            type: string
                          type:
                            description: variable type
                            type: string
                          value:
                            description: variable string value
                            type: string
                          valueFrom:
                            description: or load it from var source
                            properties:
                              configMapKeyRef:
                                description: Selects a key of a ConfigMap.
                                properties:
                                  key:
                                    description: The key to select.
                                    type: string
                                  name:
                                    description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                                    TODO: Add other useful fields. apiVersion, kind,
                                    uid?'
                                    type: string
                                  optional:
                                    description: Specify whether the ConfigMap or its
                                      key must be defined
                                    type: boolean
                                required:
                                  - key
                                type: object
                              fieldRef:
                                description: 'Selects a field of the pod: supports metadata.name,
                                metadata.namespace, `metadata.labels[''<KEY>'']`,
                                `metadata.annotations[''<KEY>'']`, spec.nodeName,
                                spec.serviceAccountName, status.hostIP, status.podIP,
                                status.podIPs.'
                                properties:
                                  apiVersion:
                                    description: Version of the schema the FieldPath
                                      is written in terms of, defaults to "v1".
                                    type: string
                                  fieldPath:
                                    description: Path of the field to select in the
                                      specified API version.
                                    type: string
                                required:
                                  - fieldPath
                                type: object
                              resourceFieldRef:
                                description: 'Selects a resource of the container: only
                                resources limits and requests (limits.cpu, limits.memory,
                                limits.ephemeral-storage, requests.cpu, requests.memory
                                and requests.ephemeral-storage) are currently supported.'
                                properties:
                                  containerName:
                                    description: 'Container name: required for volumes,
                                    optional for env vars'
                                    type: string
                                  divisor:
                                    anyOf:
                                      - type: integer
                                      - type: string
                                    description: Specifies the output format of the
                                      exposed resources, defaults to "1"
                                    pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                    x-kubernetes-int-or-string: true
                                  resource:
                                    description: 'Required: resource to select'
                                    type: string
                                required:
                                  - resource
                                type: object
                              secretKeyRef:
                                description: Selects a key of a secret in the pod's
                                  namespace
                                properties:
                                  key:
                                    description: The key of the secret to select from.  Must
                                      be a valid secret key.
                                    type: string
                                  name:
                                    description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                                    TODO: Add other useful fields. apiVersion, kind,
                                    uid?'
                                    type: string
                                  optional:
                                    description: Specify whether the Secret or its key
                                      must be defined
                                    type: boolean
                                required:
                                  - key
                                type: object
                            type: object
                        type: object
                      type: object
                    variablesFile:
                      description: variables file content - need to be in format for
                        particular executor (e.g. postman envs file)
                      type: string
                  type: object
                name:
                  description: test name
                  type: string
                schedule:
                  description: schedule in cron job format for scheduled test execution
                  type: string
                source:
                  description: reference to test source resource
                  type: string
                type:
                  description: test type
                  type: string
                uploads:
                  description: files to be used from minio uploads
                  items:
                    type: string
                  type: array
              type: object
            status:
              description: TestStatus defines the observed state of Test
              properties:
                latestExecution:
                  description: latest execution result
                  properties:
                    endTime:
                      description: test end time
                      format: date-time
                      type: string
                    id:
                      description: execution id
                      type: string
                    number:
                      description: execution number
                      format: int32
                      type: integer
                    startTime:
                      description: test start time
                      format: date-time
                      type: string
                    status:
                      enum:
                      - queued
                      - running
                      - passed
                      - failed
                      - aborted
                      - timeout
                      type: string
                  type: object
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
{{ end }}